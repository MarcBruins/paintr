---
phase: 01-foundation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - package.json
  - tsconfig.json
  - next.config.ts
  - postcss.config.mjs
  - biome.json
  - drizzle.config.ts
  - src/app/layout.tsx
  - src/app/globals.css
  - src/app/page.tsx
  - src/lib/db/index.ts
  - src/lib/db/schema/index.ts
  - src/lib/db/schema/app.ts
  - .env.local
  - .env.example
  - .gitignore
autonomous: true
requirements:
  - AUTH-05
must_haves:
  truths:
    - "Next.js 16 dev server starts without errors"
    - "Tailwind v4 utility classes render correctly"
    - "Drizzle connects to Supabase Postgres successfully"
    - "Biome lint and format commands run without errors"
    - "A quotes table with organization_id column exists in the schema definition"
  artifacts:
    - path: "package.json"
      provides: "Project dependencies and scripts"
      contains: "better-auth"
    - path: "src/lib/db/index.ts"
      provides: "Drizzle database client"
      contains: "prepare: false"
    - path: "src/lib/db/schema/app.ts"
      provides: "Application tables with RLS policies"
      contains: "organization_id"
    - path: "drizzle.config.ts"
      provides: "Drizzle Kit migration configuration"
      contains: "postgresql"
    - path: "biome.json"
      provides: "Linter and formatter configuration"
      contains: "recommended"
    - path: "src/app/layout.tsx"
      provides: "Root layout with HTML structure"
    - path: "postcss.config.mjs"
      provides: "PostCSS config for Tailwind v4"
      contains: "@tailwindcss/postcss"
  key_links:
    - from: "src/lib/db/index.ts"
      to: "src/lib/db/schema/index.ts"
      via: "schema import"
      pattern: "import.*schema"
    - from: "drizzle.config.ts"
      to: "src/lib/db/schema"
      via: "schema path configuration"
      pattern: "schema.*src/lib/db/schema"
---

<objective>
Scaffold the Next.js 16 project with all core dependencies, Tailwind v4, Biome, Drizzle ORM connected to Supabase Postgres, and the initial application schema (quotes table with organization_id and RLS policy).

Purpose: Every subsequent plan depends on a working project skeleton with database connectivity. This is the foundation that auth, org, and deploy plans build on.
Output: A running Next.js 16 dev server with Tailwind v4 styling, Biome linting, and a Drizzle schema ready for migration.
</objective>

<execution_context>
@C:/Users/MarcBruins/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/MarcBruins/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-foundation/01-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Scaffold Next.js 16 project with Tailwind v4, Biome, and core dependencies</name>
  <files>
    package.json
    tsconfig.json
    next.config.ts
    postcss.config.mjs
    biome.json
    src/app/layout.tsx
    src/app/globals.css
    src/app/page.tsx
    .gitignore
    .env.example
    .env.local
  </files>
  <action>
    Create a new Next.js 16 project in the repository root. Use `pnpm create next-app@latest . --ts --tailwind --app --src-dir --use-pnpm --turbopack` and accept defaults. If the CLI asks about customization, choose: TypeScript yes, Tailwind yes, src directory yes, app router yes.

    After scaffolding:

    1. Verify `next.config.ts` does NOT have custom webpack config (Turbopack is default in Next.js 16). Remove any webpack customization if present.

    2. Verify `postcss.config.mjs` uses the Tailwind v4 plugin:
       ```js
       const config = { plugins: { "@tailwindcss/postcss": {} } };
       export default config;
       ```
       If the scaffold created a different config (e.g., using `tailwindcss` directly or a v3-style config), replace it with the above.

    3. Update `src/app/globals.css` to use Tailwind v4 import style:
       ```css
       @import "tailwindcss";
       @theme {
         --color-brand: #2563eb;
       }
       ```
       Remove any v3-style `@tailwind base/components/utilities` directives if present.

    4. If a `tailwind.config.ts` or `tailwind.config.js` was created, delete it — Tailwind v4 uses CSS-based configuration with auto-discovery.

    5. Install all core dependencies:
       ```bash
       pnpm add better-auth drizzle-orm postgres resend
       pnpm add -D drizzle-kit @biomejs/biome vitest @types/node
       ```

    6. Initialize Biome config by running `pnpm dlx @biomejs/biome init` and then update `biome.json` to:
       ```json
       {
         "$schema": "https://biomejs.dev/schemas/2.0.0/schema.json",
         "files": { "ignoreUnknown": false, "ignore": ["node_modules", ".next", "src/lib/db/schema/auth.ts"] },
         "linter": { "enabled": true, "rules": { "recommended": true } },
         "formatter": { "enabled": true, "indentStyle": "space", "indentWidth": 2 },
         "javascript": { "formatter": { "quoteStyle": "double" } }
       }
       ```

    7. Add scripts to `package.json`:
       ```json
       "lint": "biome check .",
       "lint:fix": "biome check --write .",
       "format": "biome format --write .",
       "db:generate": "drizzle-kit generate",
       "db:migrate": "drizzle-kit migrate",
       "db:studio": "drizzle-kit studio"
       ```

    8. Create `.env.example` with placeholder variables:
       ```
       DATABASE_URL=postgresql://postgres:[password]@db.[project].supabase.co:6543/postgres
       DATABASE_URL_DIRECT=postgresql://postgres:[password]@db.[project].supabase.co:5432/postgres
       BETTER_AUTH_SECRET=your-secret-here
       BETTER_AUTH_URL=http://localhost:3000
       NEXT_PUBLIC_APP_URL=http://localhost:3000
       RESEND_API_KEY=re_your_key_here
       ```

    9. Create `.env.local` with the same structure (user will fill in real values).

    10. Ensure `.gitignore` includes `.env.local` and `.env` (but NOT `.env.example`).

    11. Update `src/app/page.tsx` to a simple landing page that displays "Paintr" with a Tailwind-styled heading to verify Tailwind v4 works.

    12. Initialize shadcn/ui: `pnpm dlx shadcn@latest init` — accept defaults (New York style, neutral color, CSS variables yes). This will configure components.json and may update globals.css. After init, verify globals.css still has the `@import "tailwindcss"` line at the top.
  </action>
  <verify>
    Run `pnpm dev` and confirm the dev server starts on localhost:3000 without errors. Visit the page and confirm "Paintr" heading renders with Tailwind styling. Run `pnpm lint` and confirm Biome runs without configuration errors.
  </verify>
  <done>Next.js 16 dev server runs, Tailwind v4 renders utility classes, Biome lint passes, all dependencies installed.</done>
</task>

<task type="auto">
  <name>Task 2: Configure Drizzle ORM with Supabase connection and application schema</name>
  <files>
    drizzle.config.ts
    src/lib/db/index.ts
    src/lib/db/schema/index.ts
    src/lib/db/schema/app.ts
  </files>
  <action>
    1. Create `drizzle.config.ts` at project root:
       ```typescript
       import type { Config } from "drizzle-kit";

       export default {
         schema: "./src/lib/db/schema",
         out: "./drizzle",
         dialect: "postgresql",
         dbCredentials: {
           url: process.env.DATABASE_URL_DIRECT!,
         },
       } satisfies Config;
       ```
       Note: Drizzle Kit migrations use the DIRECT connection (port 5432), not the pooler, because some migration operations require a direct connection.

    2. Create `src/lib/db/index.ts`:
       ```typescript
       import { drizzle } from "drizzle-orm/postgres-js";
       import postgres from "postgres";
       import * as schema from "./schema";

       const client = postgres(process.env.DATABASE_URL!, { prepare: false });
       export const db = drizzle({ client, schema });
       ```
       CRITICAL: `{ prepare: false }` is mandatory for Supabase Transaction pool mode. Without it, queries will fail with "prepared statement does not exist" in production.

    3. Create `src/lib/db/schema/app.ts` with the quotes table including RLS policy:
       ```typescript
       import { pgTable, uuid, text, timestamp, pgPolicy } from "drizzle-orm/pg-core";
       import { sql } from "drizzle-orm";

       export const quotes = pgTable(
         "quotes",
         {
           id: uuid("id").defaultRandom().primaryKey(),
           organizationId: uuid("organization_id").notNull(),
           title: text("title").notNull(),
           status: text("status", { enum: ["draft", "ready", "sent", "accepted", "declined"] }).notNull().default("draft"),
           createdById: text("created_by_id").notNull(),
           createdAt: timestamp("created_at").defaultNow().notNull(),
           updatedAt: timestamp("updated_at").defaultNow().notNull(),
         },
         (table) => [
           pgPolicy("org_isolation", {
             for: "all",
             using: sql`${table.organizationId} = current_setting('app.current_org_id', true)::uuid`,
             withCheck: sql`${table.organizationId} = current_setting('app.current_org_id', true)::uuid`,
           }),
         ]
       );
       ```

    4. Create `src/lib/db/schema/index.ts` as a barrel export:
       ```typescript
       export * from "./app";
       // auth.ts will be added here after Better Auth CLI generates it
       ```

    5. Create `src/lib/db/with-org-context.ts` — the helper that sets RLS context within a transaction:
       ```typescript
       import { db } from "./index";
       import { sql } from "drizzle-orm";

       export async function withOrgContext<T>(
         organizationId: string,
         fn: (tx: typeof db) => Promise<T>
       ): Promise<T> {
         return await db.transaction(async (tx) => {
           await tx.execute(
             sql`SELECT set_config('app.current_org_id', ${organizationId}, TRUE)`
           );
           return await fn(tx as unknown as typeof db);
         });
       }
       ```

    Note: Do NOT run `drizzle-kit generate` or `drizzle-kit migrate` yet — the Better Auth schema must be generated first (Plan 02). The schema files are set up now so Plan 02 can generate into them.
  </action>
  <verify>
    Run `pnpm exec tsc --noEmit` to verify TypeScript compilation succeeds for the schema files and db module. Confirm that `src/lib/db/schema/app.ts`, `src/lib/db/schema/index.ts`, `src/lib/db/index.ts`, `src/lib/db/with-org-context.ts`, and `drizzle.config.ts` all exist and have no type errors.
  </verify>
  <done>Drizzle ORM is configured with Supabase connection (prepare: false), quotes table schema with organization_id and RLS policy is defined, with-org-context helper is ready, and drizzle.config.ts points to the schema directory.</done>
</task>

</tasks>

<verification>
1. `pnpm dev` starts Next.js 16 on localhost:3000 without errors
2. `pnpm lint` runs Biome check without configuration errors
3. `pnpm exec tsc --noEmit` passes with no type errors
4. All files listed in files_modified exist at expected paths
5. `package.json` contains better-auth, drizzle-orm, postgres, resend in dependencies
</verification>

<success_criteria>
A complete Next.js 16 project skeleton is running with Tailwind v4 styling, Biome linting, Drizzle ORM configured for Supabase Postgres, and a quotes table schema with RLS policy defined. The project is ready for Better Auth integration in Plan 02.
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation/01-01-SUMMARY.md`
</output>
